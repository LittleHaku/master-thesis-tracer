\begin{tikzpicture}[
    node distance=0.4cm and 1.5cm,
    container/.style={rectangle, draw, thick, text centered, minimum height=1cm, minimum width=3.2cm, align=center, rounded corners=3pt},
    volume/.style={cylinder, shape border rotate=90, draw, fill=gray!20, text centered, minimum height=1.2cm, minimum width=2.2cm, aspect=0.3, align=center},
    dependency/.style={-Stealth, dashed, thick, red},
    mount/.style={-, thick, blue}
]
    % MIDDLE TIER: Application Containers (Central anchors)
    \node[container, fill=yellow!20] (backend) {Backend\\Django API\\Port 8000};
    \node[container, fill=green!20] (frontend) [left=of backend] {Frontend\\React Build};
    \node[container, fill=blue!20] (celery) [right=of backend] {Celery Worker\\Async Tasks};

    % BOTTOM TIER: Backing Services
    \node[container, fill=cyan!20] (db) [below=of backend, xshift=-2.8cm] {postgres:16\\Port 5432};
    \node[container, fill=pink!20] (rabbitmq) [below=of backend, xshift=2.8cm] {rabbitmq:3-mgmt\\Port 5672};
    
    % VOLUMES (placed relative to the structure)
    \node[volume] (staticfiles) [above=of backend] {static\_files\_prod};
    \node[volume] (reactbuild) [left=of staticfiles] {react\_build};
    \node[volume] (filevault) [right=of staticfiles] {filevault\_data\_prod};
    
    % TOP TIER: Nginx placed cleanly above the volumes
    \node[container, fill=orange!20] (nginx) [above=of staticfiles] {nginx:latest\\Port 80â†’8080};
    
    % Bottom row of volumes, dedicated to their services
    \node[volume] (pgdata) [below=of db] {postgres\_data};
    \node[volume] (rmqdata) [below=of rabbitmq] {rabbitmq\_data};

    % Dependency arrows (red dashed)
    \draw[dependency] (backend) -- (db);
    \draw[dependency] (backend) -- (rabbitmq);
    \draw[dependency] (celery) -- (db);
    \draw[dependency] (celery) -- (rabbitmq);
    \draw[dependency] (frontend) -- (backend);
    \draw[dependency] (nginx) -- (frontend);
    \draw[dependency] (nginx) to[bend left=70] (backend);

    % Volume mounts (blue solid)
    \draw[mount] (db.south) -- (pgdata.north);
    \draw[mount] (rabbitmq.south) -- (rmqdata.north);
    \draw[mount] (frontend.north) -- (reactbuild.south);
    \draw[mount] (backend.north) -- (staticfiles.south);
    \draw[mount] (celery.north) -- (filevault.south);
    \draw[mount] (nginx) to[bend left=10] (reactbuild);
    \draw[mount] (nginx) -- (staticfiles);
    \draw[mount] (backend) to[bend right=15] (filevault);
    \draw[mount] (celery) to[bend left=15] (staticfiles);

    % Legend anchored to the bottom-left of the picture
    \node[anchor=north west, align=left, yshift=-0.4cm] at (current bounding box.south west) {
        \begin{tabular}{@{}ll}
            \multicolumn{2}{l}{\textbf{Legend:}}\\
            \tikz{\draw[dependency] (0,0.5ex) -- (0.5,0.5ex);} & Container Dependency\\
            \tikz{\draw[mount] (0,0.5ex) -- (0.5,0.5ex);} & Volume Mount\\
        \end{tabular}
    };
\end{tikzpicture}
